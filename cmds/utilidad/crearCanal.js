const Discord = require("discord.js");


module.exports = {
  config: {
    nombre: "crear",
    alias: ["create"]
  },
  run: async (client, message, args) => {
    var categoriaID;
    var categoriaNombre;
    const filtro = m => m.author.id === message.author.id;
    const categoriaVoz = "892357493114667021";
    const categoriaTexto = "892357493114667020";
    global.tiempo = false;
    let embed1 = new Discord.MessageEmbed()
      .setTitle("Creaci√≥n de Canal")
      .setColor("RANDOM")
      .setThumbnail(
        "https://yt3.ggpht.com/ytc/AKedOLRb6tkzwHpIfL0-1Ly97OXVq106M-fbzIJAm8kj=s900-c-k-c0x00ffffff-no-rj"
      )
      .setDescription(
        "**Elige un tipo de canal:**\n\nüí¨ ‚Üí Canal de Texto\n\nüì¢ ‚Üí Canal de Voz"
      )
      .setFooter("Si quieres cancelar la sugerencia, reacciona a la papelera");

    let mesg = await message.channel.send(embed1);
    await mesg.react("üí¨");
    await mesg.react("üì¢");
    await mesg.react("üóë");
    const filter = (reaction, user) =>
      ["üí¨", "üì¢", "üóë"].includes(reaction.emoji.name) &&
      user.id == message.member.id &&
      user.id !== client.user.id;
    mesg
      .awaitReactions(filter, {
        max: 1
      })
      .then(async collected => {
        const reaction = collected.first();
        mesg.reactions.removeAll();

        mesg.delete();
        if (reaction.emoji.name === "üí¨") {
          let embed2 = new Discord.MessageEmbed()
            .setTitle("Creaci√≥n de Canal de Texto üí¨")
            .setColor("RANDOM")
            .setThumbnail(
              "https://yt3.ggpht.com/ytc/AKedOLRb6tkzwHpIfL0-1Ly97OXVq106M-fbzIJAm8kj=s900-c-k-c0x00ffffff-no-rj"
            )
            .setDescription(
              "**Elige una Asignatura:**\n\nüíª ‚Üí Programaci√≥n\n\nüìö ‚Üí Bases de Datos\n\nüì† ‚Üí Sistemas Inform√°ticos\n\nüìë ‚Üí Lenguajes de Marcas\n\nüìü ‚Üí Entornos de Desarrollo\n\nüí∞ ‚Üí F.O.L\n\nüíÇ ‚Üí Ingl√©s\n\nüîó ‚Üí Otros"
            )
            .setFooter(
              "Si quieres cancelar la sugerencia, reacciona a la papelera"
            );

          let mesg = await message.channel.send(embed2);
          await mesg.react("üíª");
          await mesg.react("üìö");
          await mesg.react("üì†");
          await mesg.react("üìë");
          await mesg.react("üìü");
          await mesg.react("üí∞");
          await mesg.react("üíÇ");
          await mesg.react("üîó");
          await mesg.react("üóë");
          const filter1 = (reaccion, user) =>
            ["üíª", "üìö", "üì†", "üìë", "üìü", "üí∞", "üíÇ", "üîó", "üóë"].includes(
              reaccion.emoji.name
            ) &&
            user.id == message.member.id &&
            user.id !== client.user.id;
          mesg
            .awaitReactions(filter1, {
              max: 1
            })
            .then(async collected => {
              const reaccion = collected.first();
              if (reaccion.emoji.name === "üíª") {
                categoriaID = "892412018827599973";
                categoriaNombre = "üíª PROGRAMACI√ìN";
              } else if (reaccion.emoji.name === "üìö") {
                categoriaID = "892412041590099979";
                categoriaNombre = "üìö BASES DE DATOS";
              } else if (reaccion.emoji.name === "üì†") {
                categoriaID = "892412269642788874";
                categoriaNombre = "üì† SISTEMAS INFORM√ÅTICOS";
              } else if (reaccion.emoji.name === "üìë") {
                categoriaID = "892412184930435082";
                categoriaNombre = "üìë LENGUAJES DE MARCAS";
              } else if (reaccion.emoji.name === "üìü") {
                categoriaID = "892412154005835797";
                categoriaNombre = "üìü ENTORNOS DE DESARROLLO";
              } else if (reaccion.emoji.name === "üí∞") {
                categoriaID = "892412079556935760";
                categoriaNombre = "üí∞ F.O.L.";
              } else if (reaccion.emoji.name === "üíÇ") {
                categoriaID = "892411983800979476";
                categoriaNombre = "üíÇ INGL√âS";
              } else if (reaccion.emoji.name === "üîó") {
                categoriaID = "892438695758663760";
                categoriaNombre = "üîó OTROS";
              } else if (reaccion.emoji.name === "üóë") {
                categoriaID = "Fin";
                categoriaNombre = "Fin";
              }
            })
            .then(async () => {
              mesg.delete();
              if (categoriaID == "Fin" && categoriaNombre == "Fin") return;
              let embed = new Discord.MessageEmbed()
                .setTitle("Creaci√≥n de Canal de Texto üí¨")
                .setDescription("**Escribe el nombre del canal:**")
                .setColor("#ffff00")
                .setThumbnail(
                  "https://yt3.ggpht.com/ytc/AKedOLRb6tkzwHpIfL0-1Ly97OXVq106M-fbzIJAm8kj=s900-c-k-c0x00ffffff-no-rj"
                )
                .setFooter(
                  "Si quieres parar el proceso, reacciona a la papelera"
                );

              let msg = await message.channel.send(embed);
              await msg.react("üóë");
              const filter = (reaction, user) =>
                ["üóë"].includes(reaction.emoji.name) &&
                user.id == message.member.id &&
                user.id !== client.user.id;
              msg
                .awaitReactions(filter, {
                  max: 1
                })
                .then(async collected => {
                  msg.delete();
                  global.tiempo = true;
                });
              message.channel
                .awaitMessages(filtro, { max: 1, time: 120000 })
                .then(async col => {
                  if (global.tiempo) return;
                  msg.reactions.removeAll();
                  let nombre = col.first();
                  let canal = await message.guild.channels.create(
                    nombre.content,
                    {
                      type: "text", //This create a text channel, you can make a voice one too, by changing "text" to "voice"
                      permissionOverwrites: [
                        {
                          id: message.guild.roles.everyone, //To make it be seen by a certain role, user an ID instead
                          deny: ["VIEW_CHANNEL"] //Deny permissions
                        },
                        {
                          id: message.author.id,
                          allow: [
                            "MANAGE_CHANNELS",
                            "VIEW_CHANNEL",
                            "MANAGE_ROLES"
                          ]
                        },
   //                     {
  //                        id: "892748757207228497",
  //                        allow: ["VIEW_CHANNEL"]
 //                       }
                      ],
                      parent: categoriaID
                    }
                  );

                  let finembed = new Discord.MessageEmbed()
                    .setTitle("CREACI√ìN FINALIZADA ‚úÖ")
                    .setDescription(
                      "**Tipo de canal**: Texto üí¨\n\n**Asignatura asignada**: " +
                        categoriaNombre +
                        "\n\n**Nombre del canal:** " +
                        nombre.content +
                        "\n\nActualmente eres el propietario del canal <#" +
                        canal.id +
                        ">."
                    )
                    .setColor("#00FF00")
                    .setThumbnail(
                      "https://yt3.ggpht.com/ytc/AKedOLRb6tkzwHpIfL0-1Ly97OXVq106M-fbzIJAm8kj=s900-c-k-c0x00ffffff-no-rj"
                    );
                  message.channel.send(finembed);
                });
            });
        } else if (reaction.emoji.name === "üì¢") {
          let embed2 = new Discord.MessageEmbed()
            .setTitle("Creaci√≥n de Canal de Voz üì¢")
            .setColor("RANDOM")
            .setThumbnail(
              "https://yt3.ggpht.com/ytc/AKedOLRb6tkzwHpIfL0-1Ly97OXVq106M-fbzIJAm8kj=s900-c-k-c0x00ffffff-no-rj"
            )
            .setDescription(
              "**Elige una Asignatura:**\n\nüíª ‚Üí Programaci√≥n\n\nüìö ‚Üí Bases de Datos\n\nüì† ‚Üí Sistemas Inform√°ticos\n\nüìë ‚Üí Lenguajes de Marcas\n\nüìü ‚Üí Entornos de Desarrollo\n\nüí∞ ‚Üí F.O.L\n\nüíÇ ‚Üí Ingl√©s\n\nüîó ‚Üí Otros"
            )
            .setFooter(
              "Si quieres cancelar la sugerencia, reacciona a la papelera"
            );

          let mesg = await message.channel.send(embed2);
          await mesg.react("üíª");
          await mesg.react("üìö");
          await mesg.react("üì†");
          await mesg.react("üìë");
          await mesg.react("üìü");
          await mesg.react("üí∞");
          await mesg.react("üíÇ");
          await mesg.react("üîó");
          await mesg.react("üóë");
          const filter1 = (reaccion, user) =>
            ["üíª", "üìö", "üì†", "üìë", "üìü", "üí∞", "üíÇ", "üîó", "üóë"].includes(
              reaccion.emoji.name
            ) &&
            user.id == message.member.id &&
            user.id !== client.user.id;
          mesg
            .awaitReactions(filter1, {
              max: 1
            })
            .then(async collected => {
              const reaccion = collected.first();
              if (reaccion.emoji.name === "üíª") {
                categoriaID = "892412018827599973";
                categoriaNombre = "üíª PROGRAMACI√ìN";
              } else if (reaccion.emoji.name === "üìö") {
                categoriaID = "892412041590099979";
                categoriaNombre = "üìö BASES DE DATOS";
              } else if (reaccion.emoji.name === "üì†") {
                categoriaID = "892412269642788874";
                categoriaNombre = "üì† SISTEMAS INFORM√ÅTICOS";
              } else if (reaccion.emoji.name === "üìë") {
                categoriaID = "892412184930435082";
                categoriaNombre = "üìë LENGUAJES DE MARCAS";
              } else if (reaccion.emoji.name === "üìü") {
                categoriaID = "892412154005835797";
                categoriaNombre = "üìü ENTORNOS DE DESARROLLO";
              } else if (reaccion.emoji.name === "üí∞") {
                categoriaID = "892412079556935760";
                categoriaNombre = "üí∞ F.O.L.";
              } else if (reaccion.emoji.name === "üíÇ") {
                categoriaID = "892411983800979476";
                categoriaNombre = "üíÇ INGL√âS";
              } else if (reaccion.emoji.name === "üîó") {
                categoriaID = "892438695758663760";
                categoriaNombre = "üîó OTROS";
              } else if (reaccion.emoji.name === "üóë") {
                categoriaID = "Fin";
                categoriaNombre = "Fin";
              }
            })
            .then(async () => {
              mesg.delete();
              if (categoriaID == "Fin" && categoriaNombre == "Fin") return;
              let embed = new Discord.MessageEmbed()
                .setTitle("Creaci√≥n de Canal de Voz üì¢")
                .setDescription("**Escribe el nombre del canal:**")
                .setColor("#ffff00")
                .setThumbnail(
                  "https://yt3.ggpht.com/ytc/AKedOLRb6tkzwHpIfL0-1Ly97OXVq106M-fbzIJAm8kj=s900-c-k-c0x00ffffff-no-rj"
                )
                .setFooter(
                  "Si quieres parar el proceso, reacciona a la papelera"
                );

              let msg = await message.channel.send(embed);
              await msg.react("üóë");
              const filter = (reaction, user) =>
                ["üóë"].includes(reaction.emoji.name) &&
                user.id == message.member.id &&
                user.id !== client.user.id;
              msg
                .awaitReactions(filter, {
                  max: 1
                })
                .then(async collected => {
                  msg.delete();
                  global.tiempo = true;
                });
              message.channel
                .awaitMessages(filtro, { max: 1, time: 120000 })
                .then(async col => {
                  if (global.tiempo) return;
                  msg.reactions.removeAll();
                  let nombre = col.first();

                  let canal = await message.guild.channels.create(
                    nombre.content,
                    {
                      type: "voice", //This create a text channel, you can make a voice one too, by changing "text" to "voice"
                      permissionOverwrites: [
                        {
                          id: message.guild.roles.everyone, //To make it be seen by a certain role, user an ID instead
                          deny: ["VIEW_CHANNEL"] //Deny permissions
                        },
                        {
                          id: message.author.id,
                          allow: [
                            "MANAGE_CHANNELS",
                            "VIEW_CHANNEL",
                            "MANAGE_ROLES"
                          ]
                        }
                      ],
                      parent: categoriaID
                    }
                  );

                  let finembed = new Discord.MessageEmbed()
                    .setTitle("CREACI√ìN FINALIZADA ‚úÖ")
                    .setDescription(
                      "**Tipo de canal**: Voz üì¢\n\n**Asignatura asignada**: " +
                        categoriaNombre +
                        "\n\n**Nombre del canal:** " +
                        nombre.content +
                        "\n\nActualmente eres el propietario del canal <#" +
                        canal.id +
                        ">."
                    )
                    .setColor("#00FF00")
                    .setThumbnail(
                      "https://yt3.ggpht.com/ytc/AKedOLRb6tkzwHpIfL0-1Ly97OXVq106M-fbzIJAm8kj=s900-c-k-c0x00ffffff-no-rj"
                    );
                  message.channel.send(finembed);
                });
            });
        }
      });
  }
};
